<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>INDETEC · Datos Hacendarios · Reportes PBI</title>
<meta name="color-scheme" content="light dark">

<link rel="dns-prefetch" href="https://script.google.com">
<link rel="preconnect" href="https://script.google.com" crossorigin>
<link rel="dns-prefetch" href="https://app.powerbi.com">
<link rel="preconnect" href="https://app.powerbi.com" crossorigin>

<style>
  :root{--bg:#fff;--fg:#111;--muted:#667;--card:#f6f7fb;--border:#e6e8ef;--accent:#2f6fed}
  @media (prefers-color-scheme:dark){
    :root{--bg:#0b0d12;--fg:#eaeef8;--muted:#98a0b3;--card:#121621;--border:#22283a;--accent:#6aa7ff}
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;background:var(--bg);border-bottom:1px solid var(--border);z-index:10}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{font-size:1.2rem;margin:0 0 6px}
  .sub{color:var(--muted);font-size:.92rem;margin:0}
  .toolbar{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin-top:12px}
  input[type=search]{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--fg)}
  .btn{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--fg);cursor:pointer}
  .btn[aria-pressed=true]{border-color:var(--accent);color:var(--accent)}
  main{padding:18px 0}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width:920px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
  .title{margin:0;font-size:1rem}
  .id{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.76rem;color:var(--muted)}
  .meta{display:flex;gap:8px;flex-wrap:wrap}
  .tag{font-size:.75rem;color:var(--muted);padding:2px 8px;border:1px solid var(--border);border-radius:999px}
  .actions{display:flex;gap:8px;margin-top:auto}
  .a{flex:1;text-align:center;text-decoration:none;border:1px solid var(--border);border-radius:10px;padding:9px}
  .a.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .hint{color:var(--muted);font-size:.85rem}
  .empty{padding:24px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Datos Hacendarios · Reportes Power BI</h1>
    <p class="sub">Enlaces con dominio GitHub → registro en Apps Script → redirección a Power BI.</p>
    <div class="toolbar" role="region" aria-label="Herramientas">
      <input id="q" type="search" placeholder="Buscar… (Ej.: EFIPem, predial, pe_2000_2023)" autocomplete="off" aria-label="Buscar">
      <button id="toggleGroup" class="btn" aria-pressed="true" title="Agrupar por categoría">Agrupar</button>
      <button id="toggleIds" class="btn" aria-pressed="false" title="Mostrar IDs">IDs</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <!-- 🧾 Contenido ESTÁTICO (ya usable sin JS) -->
    <div id="static" class="grid">
      <!-- Generado a mano para TTFB mínimo; JS lo mejorará luego -->
      <article class="card"><h3 class="title">Pronósticos</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=pronosticos">Abrir</a></div></article>
      <article class="card"><h3 class="title">Impuestos potenciales</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=impuestos_potenciales">Abrir</a></div></article>
      <article class="card"><h3 class="title">Mapas</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=mapas">Abrir</a></div></article>
      <article class="card"><h3 class="title">Indicadores</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=indicadores">Abrir</a></div></article>
      <article class="card"><h3 class="title">Panorama de la Hacienda Pública</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=panorama_hacienda">Abrir</a></div></article>
      <article class="card"><h3 class="title">Ambientales</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=ambientales">Abrir</a></div></article>
      <article class="card"><h3 class="title">Deuda</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=deuda">Abrir</a></div></article>
      <article class="card"><h3 class="title">Municipal</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=municipal">Abrir</a></div></article>

      <article class="card"><h3 class="title">PE por capítulo 2015–2024</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=pe_cap_2015_2024">Abrir</a></div></article>
      <article class="card"><h3 class="title">PE 2000–2023</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=pe_2000_2023">Abrir</a></div></article>
      <article class="card"><h3 class="title">PE por entidad</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=pe_entidades">Abrir</a></div></article>
      <article class="card"><h3 class="title">EFIPEM 1989–2024</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=efipem_1989_2024">Abrir</a></div></article>
      <article class="card"><h3 class="title">EFIPEM 1989–2023</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=efipem_1989_2023">Abrir</a></div></article>
      <article class="card"><h3 class="title">EFIPEM 2023</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=efipem_2023">Abrir</a></div></article>
      <article class="card"><h3 class="title">Cuentas públicas (capitales)</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=cuentas_capitales">Abrir</a></div></article>

      <article class="card"><h3 class="title">Balance CP 2014–2024</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=balance_cp_2014_2024">Abrir</a></div></article>
      <article class="card"><h3 class="title">Balance proyectado 2025–2030</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=balance_proj_2025_2030">Abrir</a></div></article>
      <article class="card"><h3 class="title">Balance LDF 2017–2024</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=balance_ldf_2017_2024">Abrir</a></div></article>
      <article class="card"><h3 class="title">Estado Analítico de Ingresos (LDF)</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=eai_ldf">Abrir</a></div></article>

      <article class="card"><h3 class="title">Mapas de personal ocupado</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=mapas_personal">Abrir</a></div></article>
      <article class="card"><h3 class="title">Impuesto predial potencial</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=predial_potencial">Abrir</a></div></article>

      <!-- 🆕 Nuevos -->
      <article class="card"><h3 class="title">Derechos de agua potable</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=derechos_agua">Abrir</a></div></article>
      <article class="card"><h3 class="title">Censos Económicos 2024</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="go.html?id=censos_eco24">Abrir</a></div></article>
    </div>

    <div id="app" hidden></div>
    <p class="hint" style="margin-top:16px">Tip: los enlaces inician en <code>github.io</code> y registran el clic en servidor antes de llevarte a Power BI.</p>
  </div>
</main>

<!-- JS diferido: no bloquea render -->
<script defer>
/* ========= AJUSTE ROBUSTO PARA GITHUB PAGES =========
   Construimos SIEMPRE un enlace ABSOLUTO hacia go.html,
   funcione tu sitio en raíz (usuario.github.io/) o en /REPO/.
======================================================*/
function absoluteGoUrl(){
  // go.html en la MISMA carpeta que index.html
  return new URL('go.html', document.baseURI).toString();
}
function linkFor(id){
  const u = new URL(absoluteGoUrl());
  u.searchParams.set('id', id);
  return u.toString(); // absoluto, listo para copiar/compartir
}

const REPORTS={
  pe_cap_2015_2024:{name:'Presupuestos de egresos estatales a nivel capítulo para el periodo 2015 a 2024'},
  pe_2000_2023:{name:'Presupuesto de egresos 2000 a 2023'},
  pe_entidades:{name:'Reporte del presupuesto de egresos por entidad federativa'},
  efipem_1989_2024:{name:'Estadísticas de finanzas públicas municipales y estatales. EFIPEM 1989-2024'},
  cuentas_capitales:{name:'Cuentas públicas de los municipios capitales'},
  leyes_2019_2025:{name:'Estadísticas de Leyes de Ingresos 2019-2025'},
  leyes_imp_2019_2025:{name:'Estadísticas de Leyes de Ingresos Impuestos 2019-2025'},
  efipem_2023:{name:'Estadísticas de finanzas públicas municipales. EFIPEM 2023'},
  efipem_1989_2023:{name:'Estadísticas de finanzas públicas municipales. EFIPEM 1989-2023'},
  deuda_municipal:{name:'Reporte de deuda pública municipal'},
  balance_cp_2014_2024:{name:'Balance de Cuentas Públicas (2014-2024)'},
  balance_proj_2025_2030:{name:'Balance de Ingresos y Egresos Proyectados 2025-2030'},
  balance_ldf_2017_2024:{name:'Balance de resultado de ingresos y egresos LDF 2017-2024'},
  eai_ldf:{name:'Estado Analítico de los Ingresos LDF'},
  mapas_personal:{name:'Mapas de personal ocupado por actividad económica'},
  predial_potencial:{name:'Impuesto predial potencial'},
  impuestos_potenciales:{name:'Impuestos potenciales'},
  pronosticos:{name:'Pronósticos'},
  mapas:{name:'Mapas'},
  indicadores:{name:'Indicadores'},
  panorama_hacienda:{name:'Panorama de la Hacienda Pública'},
  ambientales:{name:'Ambientales'},
  deuda:{name:'Deuda'},
  municipal:{name:'Municipal'},

  /* 🆕 Nuevos */
  derechos_agua:{name:'Derechos de agua potable'},
  censos_eco24:{name:'Censos Económicos 2024'}
};

const q=document.getElementById('q');
const btnGroup=document.getElementById('toggleGroup');
const btnIds=document.getElementById('toggleIds');
const app=document.getElementById('app');
let grouped=true, showIds=false;

function categorize(id,name){
  const t=(id+" "+name).toLowerCase();
  if(/^pe_/.test(id)) return "Presupuesto de Egresos (PE)";
  if(t.includes("efipem")) return "EFIPEM";
  if(t.includes("leyes")) return "Leyes de Ingresos";
  if(t.includes("balance")) return "Balances";
  if(["pronosticos","impuestos_potenciales","predial_potencial"].includes(id)) return "Modelos y Potenciales";
  if(["mapas","mapas_personal"].includes(id)) return "Mapas";
  if(["indicadores","panorama_hacienda"].includes(id)) return "Indicadores y Panorama";
  if(["deuda","deuda_municipal"].includes(id)) return "Deuda";
  if(id==="municipal") return "Municipal";
  if(id==="ambientales") return "Ambientales";
  // 🆕 categorías específicas
  if(id==="derechos_agua") return "Ingresos y Derechos";
  if(id==="censos_eco24")  return "Censos Económicos";
  return "Otros";
}
function esc(s){ return s.replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function card(it){
  return `<article class="card">
    <h3 class="title">${esc(it.name)}</h3>
    ${showIds?`<div class="id">${it.id}</div>`:''}
    <div class="meta"><span class="tag">PBI</span><span class="tag">${esc(it.cat)}</span></div>
    <div class="actions">
      <a class="a" href="${it.link}" rel="noopener">Abrir</a>
      <button class="a" type="button" onclick="navigator.clipboard.writeText('${it.link}')">Copiar</button>
      <a class="a primary" href="${it.link}" rel="noopener">Ir ahora</a>
    </div>
  </article>`;
}
function render(){
  // Oculta el bloque estático y pinta el dinámico
  document.getElementById('static').hidden=true;
  app.hidden=false;

  const term=q.value.trim().toLowerCase();
  const items=Object.entries(REPORTS)
    .map(([id,v])=>({id,name:v.name,link:linkFor(id),cat:categorize(id,v.name)}))
    .filter(x=>!term||x.id.toLowerCase().includes(term)||x.name.toLowerCase().includes(term));

  if(!grouped){
    app.innerHTML=`<div class="grid">${items.map(card).join("")||`<div class="empty">Sin resultados</div>`}</div>`;
    return;
  }
  const groups={}; for(const it of items){ (groups[it.cat]??=[]).push(it); }
  const order=Object.keys(groups).sort((a,b)=>a.localeCompare(b,'es'));
  app.innerHTML=order.map(cat=>`
    <section>
      <h2 style="font-size:1rem;margin:12px 0 8px">${esc(cat)} <span class="tag">${groups[cat].length}</span></h2>
      <div class="grid">${groups[cat].map(card).join("")}</div>
    </section>`).join("") || `<div class="empty">Sin resultados</div>`;
}
q.addEventListener("input",render);
btnGroup.addEventListener("click",()=>{grouped=!grouped;btnGroup.setAttribute("aria-pressed",String(grouped));render();});
btnIds.addEventListener("click",()=>{showIds=!showIds;btnIds.setAttribute("aria-pressed",String(showIds));render();});

// mejora tras el primer pintado
window.addEventListener('DOMContentLoaded', render, {once:true});
<script>
  // Mostrar página "en construcción" y ocultar el resto
  document.body.innerHTML = `
    <div style="
      height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      background:#0b0d12;
      color:#eaeef8;
      font-family:Inter, Nunito, system-ui, sans-serif;
      text-align:center;
    ">
      <h1 style="font-size:2.2rem;">🚧 En Construcción 🚧</h1>
      <p style="color:#a3a9b9;">La plataforma <strong>Datos Hacendarios</strong> estará disponible próximamente.</p>
      <div style="
        margin-top:2rem;
        border:4px solid #1a1e2a;
        border-top:4px solid #2f6fed;
        border-radius:50%;
        width:42px;height:42px;
        animation:spin 1s linear infinite;
      "></div>
      <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
    </div>
  `;
</script>
</body>
</html>
