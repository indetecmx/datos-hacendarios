<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>INDETEC Â· Datos Hacendarios Â· Reportes PBI</title>
<meta name="color-scheme" content="light dark">

<link rel="dns-prefetch" href="https://script.google.com">
<link rel="preconnect" href="https://script.google.com" crossorigin>
<link rel="dns-prefetch" href="https://app.powerbi.com">
<link rel="preconnect" href="https://app.powerbi.com" crossorigin>

<style>
  :root{--bg:#fff;--fg:#111;--muted:#667;--card:#f6f7fb;--border:#e6e8ef;--accent:#2f6fed}
  @media (prefers-color-scheme:dark){
    :root{--bg:#0b0d12;--fg:#eaeef8;--muted:#98a0b3;--card:#121621;--border:#22283a;--accent:#6aa7ff}
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;background:var(--bg);border-bottom:1px solid var(--border);z-index:10}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{font-size:1.2rem;margin:0 0 6px}
  .sub{color:var(--muted);font-size:.92rem;margin:0}
  .toolbar{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin-top:12px}
  input[type=search]{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--fg)}
  .btn{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--fg);cursor:pointer}
  .btn[aria-pressed=true]{border-color:var(--accent);color:var(--accent)}
  main{padding:18px 0}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width:920px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
  .title{margin:0;font-size:1rem}
  .id{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.76rem;color:var(--muted)}
  .meta{display:flex;gap:8px;flex-wrap:wrap}
  .tag{font-size:.75rem;color:var(--muted);padding:2px 8px;border:1px solid var(--border);border-radius:999px}
  .actions{display:flex;gap:8px;margin-top:auto}
  .a{flex:1;text-align:center;text-decoration:none;border:1px solid var(--border);border-radius:10px;padding:9px;cursor:pointer}
  .a.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .hint{color:var(--muted);font-size:.85rem}
  .empty{padding:24px;color:var(--muted)}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:var(--fg);color:var(--bg);padding:8px 12px;border-radius:10px;font-size:.9rem;opacity:0;transition:opacity .2s}
  .toast.show{opacity:.9}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Datos Hacendarios Â· Reportes Power BI</h1>
    <p class="sub">Enlaces directos a Power BI con registro de clics asÃ­ncrono (sin doble redirecciÃ³n).</p>
    <div class="toolbar" role="region" aria-label="Herramientas">
      <input id="q" type="search" placeholder="Buscarâ€¦ (Ej.: EFIPem, predial, pe_2000_2023)" autocomplete="off" aria-label="Buscar">
      <button id="toggleGroup" class="btn" aria-pressed="true" title="Agrupar por categorÃ­a">Agrupar</button>
      <button id="toggleIds" class="btn" aria-pressed="false" title="Mostrar IDs">IDs</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <!-- ðŸ§¾ Fallback estÃ¡tico mÃ­nimo -->
    <div id="static" class="grid">
      <article class="card"><h3 class="title">PronÃ³sticos</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="#" onclick="return openReport('pronosticos')">Abrir</a></div></article>
      <article class="card"><h3 class="title">Impuestos potenciales</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="#" onclick="return openReport('impuestos_potenciales')">Abrir</a></div></article>
      <article class="card"><h3 class="title">Mapas</h3><div class="meta"><span class="tag">PBI</span></div><div class="actions"><a class="a primary" href="#" onclick="return openReport('mapas')">Abrir</a></div></article>
    </div>

    <div id="app" hidden></div>
    <p class="hint" style="margin-top:16px">Tip: los clics se registran con <code>sendBeacon</code> sin frenar la navegaciÃ³n a Power BI.</p>
  </div>
</main>

<div id="toast" class="toast" role="status" aria-live="polite">Copiado</div>

<script defer>
/* ====== CONFIGURACIÃ“N ====== */

// URL de tu Apps Script (ejecuciÃ³n pÃºblica) para registrar clics
const TRACK_URL = "https://script.google.com/macros/s/AKfycbzHrQSlW2c-hV2myQ3er9WDlMm1DGDJ32YPBQeapF5n4HqS0A5X58jGnXyrttoOv4x8Yg/exec";

// CatÃ¡logo (id â†’ nombre) â€” sin URLs aquÃ­
const REPORTS = {
  pe_cap_2015_2024:{name:'Presupuestos de egresos estatales a nivel capÃ­tulo para el periodo 2015 a 2024'},
  pe_2000_2023:{name:'Presupuesto de egresos 2000 a 2023'},
  pe_entidades:{name:'Reporte del presupuesto de egresos por entidad federativa'},
  efipem_1989_2024:{name:'EstadÃ­sticas de finanzas pÃºblicas municipales y estatales. EFIPEM 1989-2024'},
  cuentas_capitales:{name:'Cuentas pÃºblicas de los municipios capitales'},
  leyes_2019_2025:{name:'EstadÃ­sticas de Leyes de Ingresos 2019-2025'},
  leyes_imp_2019_2025:{name:'EstadÃ­sticas de Leyes de Ingresos Impuestos 2019-2025'},
  efipem_2023:{name:'EstadÃ­sticas de finanzas pÃºblicas municipales. EFIPEM 2023'},
  efipem_1989_2023:{name:'EstadÃ­sticas de finanzas pÃºblicas municipales. EFIPEM 1989-2023'},
  deuda_municipal:{name:'Reporte de deuda pÃºblica municipal'},
  balance_cp_2014_2024:{name:'Balance de Cuentas PÃºblicas (2014-2024)'},
  balance_proj_2025_2030:{name:'Balance de Ingresos y Egresos Proyectados 2025-2030'},
  balance_ldf_2017_2024:{name:'Balance de resultado de ingresos y egresos LDF 2017-2024'},
  eai_ldf:{name:'Estado AnalÃ­tico de los Ingresos LDF'},
  mapas_personal:{name:'Mapas de personal ocupado por actividad econÃ³mica'},
  predial_potencial:{name:'Impuesto predial potencial'},
  impuestos_potenciales:{name:'Impuestos potenciales'},
  pronosticos:{name:'PronÃ³sticos'},
  mapas:{name:'Mapas'},
  indicadores:{name:'Indicadores'},
  panorama_hacienda:{name:'Panorama de la Hacienda PÃºblica'},
  ambientales:{name:'Ambientales'},
  deuda:{name:'Deuda'},
  municipal:{name:'Municipal'},
  derechos_agua:{name:'Derechos de agua potable'},
  censos_eco24:{name:'Censos EconÃ³micos 2024'},

  /* Mapas por estado */
  mapas_AGS:{ name:'Mapas Â· AGS' },
  mapas_BC:{  name:'Mapas Â· BC'  },
  mapas_BCS:{ name:'Mapas Â· BCS' },
  mapas_CAMP:{name:'Mapas Â· CAMP'},
  mapas_CHIS:{name:'Mapas Â· CHIS'},
  mapas_CHIH:{name:'Mapas Â· CHIH'},
  mapas_COAH:{name:'Mapas Â· COAH'},
  mapas_COL:{ name:'Mapas Â· COL' },
  mapas_CDMX:{name:'Mapas Â· CDMX'},
  mapas_DGO:{ name:'Mapas Â· DGO' },
  mapas_GTO:{ name:'Mapas Â· GTO' },
  mapas_GRO:{ name:'Mapas Â· GRO' },
  mapas_HGO:{ name:'Mapas Â· HGO' },
  mapas_JAL:{ name:'Mapas Â· JAL' },
  mapas_EDOMEX:{name:'Mapas Â· EDOMEX'},
  mapas_MICH:{name:'Mapas Â· MICH'},
  mapas_MOR:{ name:'Mapas Â· MOR' },
  mapas_NAY:{ name:'Mapas Â· NAY' },
  mapas_NL:{  name:'Mapas Â· NL'  },
  mapas_OAX:{ name:'Mapas Â· OAX' },
  mapas_SLP:{ name:'Mapas Â· SLP' },
  mapas_PUE:{ name:'Mapas Â· PUE' },
  mapas_QRO:{ name:'Mapas Â· QRO' },
  mapas_QROO:{name:'Mapas Â· QROO'},
  mapas_SIN:{ name:'Mapas Â· SIN' },
  mapas_SON:{ name:'Mapas Â· SON' },
  mapas_TAB:{ name:'Mapas Â· TAB' },
  mapas_TAMPS:{name:'Mapas Â· TAMPS'},
  mapas_TLAX:{name:'Mapas Â· TLAX'},
  mapas_VER:{ name:'Mapas Â· VER' },
  mapas_YUC:{ name:'Mapas Â· YUC' },  /* <- alineado con tu Apps Script */
  mapas_ZAC:{ name:'Mapas Â· ZAC' }
};

// Destinos (id â†’ URL final en Power BI)
const TARGETS = {
  pe_cap_2015_2024:"https://app.powerbi.com/view?r=eyJrIjoiNGJkYjJjNDItNjdjYS00YTg3LWE3YjUtZDMzYjUwZTMxNzlmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  pe_2000_2023:"https://app.powerbi.com/view?r=eyJrIjoiMzgxODE4ZDEtYTRjNi00MDZiLTg1ZWMtMTkyNDMzMTlmNjc4IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  pe_entidades:"https://app.powerbi.com/view?r=eyJrIjoiMTk3YzZmMmQtZDA2OC00YTBlLWIwNWEtOWMwMWM2NTNjZWJhIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  efipem_1989_2024:"https://app.powerbi.com/view?r=eyJrIjoiNzg1MWNhM2UtNDFhNy00YzUyLWExZDEtMjkxMWRiNDE5MTEwIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  cuentas_capitales:"https://app.powerbi.com/view?r=eyJrIjoiMmZjZGZmN2QtOWFjMS00OTM4LWFhNTAtMDc1OWI2Mzg0NDVmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  leyes_2019_2025:"https://app.powerbi.com/view?r=eyJrIjoiNTlmZGZiYmQtMzYzNC00MzI0LTgzNTItZmU5NmFjMjU4MjAxIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9&pageName=ReportSection3b90823ea5fa0795f306",
  leyes_imp_2019_2025:"https://app.powerbi.com/view?r=eyJrIjoiNDdlZGRlNDAtZGNlNC00NDBiLTk0YmQtYTBhMjUwM2NkOWMwIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9&pageName=ReportSection3b90823ea5fa0795f306",
  efipem_2023:"https://app.powerbi.com/view?r=eyJrIjoiODkzNTY5M2QtNjkxYy00MTNiLWJmNmYtNzM4ZTQ2ZGZhYzI5IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  efipem_1989_2023:"https://app.powerbi.com/view?r=eyJrIjoiNmE2NTUwYmEtNzQwNC00OTU4LTk5NmMtYWFlZjVhMmY3MDUxIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  deuda_municipal:"https://app.powerbi.com/view?r=eyJrIjoiNWI3NmRiZjYtMzczMy00M2Q4LWE2YjctNDBiMmZmOWFjNDgwIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  balance_cp_2014_2024:"https://app.powerbi.com/view?r=eyJrIjoiZjkzYmJkZWYtNTZkZi00NzMxLTkyMjItMjc2ZGRjMTVjMGQxIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9&pageName=ReportSection",
  balance_proj_2025_2030:"https://app.powerbi.com/view?r=eyJrIjoiNGZkZmM5OGItNDljYi00MDExLWFlZTctNTMxZjRiZjEwMTVkIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  balance_ldf_2017_2024:"https://app.powerbi.com/view?r=eyJrIjoiZWMzNjhlNzItZjFiZi00MGMwLWJmNzQtMjE1MDE1NWYwMDJiIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  eai_ldf:"https://app.powerbi.com/view?r=eyJrIjoiNWNjNmQ4YWMtNjNhMi00OTg1LWE4MDUtM2QwNThjZGU5MDI3IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  mapas_personal:"https://app.powerbi.com/view?r=eyJrIjoiMzY4NmVlNGEtN2M5Zi00OTM3LTkwMDMtYThmMWQ5NjU0ZTg0IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  predial_potencial:"https://app.powerbi.com/view?r=eyJrIjoiODkyYTUyMzMtNGQ2Yy00ZTBkLTlkNGYtYjM1MDA0MmEyNjI3IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  impuestos_potenciales:"https://app.powerbi.com/view?r=eyJrIjoiNjQwZWFmYmQtZGViNS00ZWNhLWJmZTYtYWVhZGY4NGQ0NTE5IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9&pageName=ReportSectionbc92482a221c92453c0d",
  pronosticos:"https://app.powerbi.com/view?r=eyJrIjoiZTI0NzE1ODMtNzQ1Ni00MjA1LWFiMDEtMTRlYmY5MzU1ODAzIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  mapas:"https://app.powerbi.com/view?r=eyJrIjoiNjY3YTY4ZjItZjY0Mi00OWFiLWJlZmMtNmI0M2E4YjE4MGI5IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  indicadores:"https://app.powerbi.com/view?r=eyJrIjoiNzEzMGFlNzYtZDhkMS00ODhkLWJiMTEtMGU5YmFhYmUwNDA2IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  panorama_hacienda:"https://app.powerbi.com/view?r=eyJrIjoiYzczZWEwNWItNWNjNC00M2UyLTkyN2YtYTVkODE4NDczNjczIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  ambientales:"https://app.powerbi.com/view?r=eyJrIjoiODFkYjFkNWItMzg5Zi00YjA3LTlkMTUtMGE5NTI5MzUxNmE3IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  deuda:"https://app.powerbi.com/view?r=eyJrIjoiNWI3NmRiZjYtMzczMy00M2Q4LWE2YjctNDBiMmZmOWFjNDgwIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  municipal:"https://app.powerbi.com/view?r=eyJrIjoiMmZjZGZmN2QtOWFjMS00OTM4LWFhNTAtMDc1OWI2Mzg0NDVmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  derechos_agua:"https://app.powerbi.com/view?r=eyJrIjoiYzUyMjU1YjUtZDdjNy00MTQxLWE2NzgtN2MxNWJkZGRhZGMyIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  censos_eco24:"https://app.powerbi.com/view?r=eyJrIjoiZDJkODBkZWUtNmE3MC00NDdjLWFkOTUtZGY2MDZlNGI0NTdjIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9",
  mapas_AGS:'https://app.powerbi.com/view?r=eyJrIjoiNGYyN2ZmZGUtZmFlYS00NTBkLWIxZjEtZDg3ZTE1ZTA0YmM3IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_BC:'https://app.powerbi.com/view?r=eyJrIjoiODI0MTNlNmItY2QzZS00MTVlLWFjMjEtMzIzYmU5M2NiYTVmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_BCS:'https://app.powerbi.com/view?r=eyJrIjoiZDUwMmExMDctOWQ0OC00ZWI4LWE1YmYtZGNmYWUxNjE4NWFkIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_CAMP:'https://app.powerbi.com/view?r=eyJrIjoiZTYxZmFiODYtNTU5OC00YWZjLWEyYmItNTMxYWVlNDFlYzFlIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_CHIS:'https://app.powerbi.com/view?r=eyJrIjoiMjRhNGE2ODItZDE1NC00YTllLWJiMmYtODI0OTU5NWQ1ZDA1IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_CHIH:'https://app.powerbi.com/view?r=eyJrIjoiNDM1MTg4ZmYtYWFjMC00MWM5LTk2NTAtYjgwN2Y3ZmJlNTI4IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_COAH:'https://app.powerbi.com/view?r=eyJrIjoiZjZhOWQzODAtMmYwMi00MmViLWEwNjItNzI5YTBjMjI1YzdlIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_COL:'https://app.powerbi.com/view?r=eyJrIjoiZGM3MWIyNDEtNzI4OC00YmQ4LWE3MWYtMmQ0ZTllNTg1NTMxIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_CDMX:'https://app.powerbi.com/view?r=eyJrIjoiYWRiMjhmNmQtMTBjNy00MmY5LWE2MDYtMjVmNjQ0N2JjODJhIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_DGO:'https://app.powerbi.com/view?r=eyJrIjoiNWYzNGNmOTktNDI4Ny00YTYyLThkYjktZjUxYjkxNjQ4NjAwIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_GTO:'https://app.powerbi.com/view?r=eyJrIjoiZTkzYWE5ZmQtN2ViNC00YjgzLThkNTYtMDdmNjhiMmNjYTExIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_GRO:'https://app.powerbi.com/view?r=eyJrIjoiYTM2ZjNjNzUtZmM1MS00Y2U2LWExZDktOTFiN2I1ZDg3MmZiIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_HGO:'https://app.powerbi.com/view?r=eyJrIjoiODY2NWIwZDItNzdhMC00MDAzLWE4ZWMtMDk4ZWMzODMwOWZhIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_JAL:'https://app.powerbi.com/view?r=eyJrIjoiOGQ0MzE4NzYtM2IyOS00ZTFiLWI5ZTctZjdjMjBiMjI2NDhmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_EDOMEX:'https://app.powerbi.com/view?r=eyJrIjoiODY1MzkzZTUtMDQ5Zi00NWJlLWIyZWQtNzkxYjRiYjU3Njk1IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_MICH:'https://app.powerbi.com/view?r=eyJrIjoiMjRlN2U1YmQtMGZkYy00NWJiLTg2ZmUtYmU3YmVjNzY3ZWQxIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_MOR:'https://app.powerbi.com/view?r=eyJrIjoiYWNlYThiNWUtOTRmMC00YTk0LWI3YzktMmZlYmMwZWIwNzJlIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_NAY:'https://app.powerbi.com/view?r=eyJrIjoiZjY5MjM1ODUtNGY0ZC00Mzk2LWI5NGYtMjA4ODkxMWU1Yzc2IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_NL:'https://app.powerbi.com/view?r=eyJrIjoiZjRlMDMyMjItMWM1NC00YjEyLTk4NTEtZDg1ZjRiNTZkOTVmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_OAX:'https://app.powerbi.com/view?r=eyJrIjoiZGEzYjA3ODMtOTcxZi00ZTFmLTk0M2ItYWQyMmU0OTlmZTRlIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_SLP:'https://app.powerbi.com/view?r=eyJrIjoiZjQzMTQxMDItZGNhZC00ZmRiLTk0MGQtOGZmNWFjM2ViODVhIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_PUE:'https://app.powerbi.com/view?r=eyJrIjoiMWYwNDY1NjgtZTNiOS00ZTRlLWJhODUtZDE2MGVkNjdhNjc2IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_QRO:'https://app.powerbi.com/view?r=eyJrIjoiNDFjYWI4NzgtMzJkMi00MWQ3LTgzYzMtMzc2ODVmNzg5MjdjIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_QROO:'https://app.powerbi.com/view?r=eyJrIjoiM2YzODNkNDEtMmUyYy00MDQ5LWJmZmEtZWIzMTBkNTRmOTA4IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_SIN:'https://app.powerbi.com/view?r=eyJrIjoiZWJmNzMyNTctMWJiYy00ZWYyLTg1YTItZjkzZTliY2JmNGFmIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_SON:'https://app.powerbi.com/view?r=eyJrIjoiNjJiYzYzZjEtNTkwNy00NjVhLTg2MWUtYTJjMmVjODgwODY4IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_TAB:'https://app.powerbi.com/view?r=eyJrIjoiZjhmZGVhZDUtM2NkYS00NDIxLWI5ZTYtOWU0ZmY4MWE4ZTJkIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_TAMPS:'https://app.powerbi.com/view?r=eyJrIjoiMTdmODFmZDctMGY5ZS00N2U4LWE1YWMtYTBlYTI3MGY4MDc4IiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_TLAX:'https://app.powerbi.com/view?r=eyJrIjoiMDQzNjk1YzktZGZhZC00ZTg5LWI4ZGMtMzEzZTk4MTJmOTBjIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_VER:'https://app.powerbi.com/view?r=eyJrIjoiMjRlMDczYWEtMWZkNC00ZTI2LWJkM2EtZWZmNTA2Zjg1NTZjIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_YUC:'https://app.powerbi.com/view?r=eyJrIjoiNzNkMmUzYjctZWZhZC00NjQ5LWE3MTYtZWY3NWE0NmRmZTUzIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9',
  mapas_ZAC:'https://app.powerbi.com/view?r=eyJrIjoiMWQ5YTI0NGYtNzg1ZS00NGVmLWIzNzMtZTU0YTg5YzI4ZWVjIiwidCI6IjRhZjM1NGU0LTM0Y2MtNGM0Yy1hY2MwLTIyMmZkMDU1NTZiNiJ9'
};

/* ====== LÃ“GICA UI ====== */
const q=document.getElementById('q');
const btnGroup=document.getElementById('toggleGroup');
const btnIds=document.getElementById('toggleIds');
const app=document.getElementById('app');
const toast=document.getElementById('toast');
let grouped=true, showIds=false;

function categorize(id,name){
  const t=(id+" "+name).toLowerCase();
  if(/^pe_/.test(id)) return "Presupuesto de Egresos (PE)";
  if(t.includes("efipem")) return "EFIPEM";
  if(t.includes("leyes")) return "Leyes de Ingresos";
  if(t.includes("balance")) return "Balances";
  if(["pronosticos","impuestos_potenciales","predial_potencial"].includes(id)) return "Modelos y Potenciales";
  if(["mapas","mapas_personal"].includes(id)) return "Mapas";
  if(id.startsWith("mapas_")) return "Mapas por estado";
  if(["indicadores","panorama_hacienda"].includes(id)) return "Indicadores y Panorama";
  if(["deuda","deuda_municipal"].includes(id)) return "Deuda";
  if(id==="municipal") return "Municipal";
  if(id==="ambientales") return "Ambientales";
  if(id==="derechos_agua") return "Ingresos y Derechos";
  if(id==="censos_eco24")  return "Censos EconÃ³micos";
  return "Otros";
}
function esc(s){ return s.replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'), 1200);
}

function card(it){
  const link = TARGETS[it.id] || "#";
  return `<article class="card">
    <h3 class="title">${esc(it.name)}</h3>
    ${showIds?`<div class="id">${it.id}</div>`:''}
    <div class="meta"><span class="tag">PBI</span><span class="tag">${esc(it.cat)}</span></div>
    <div class="actions">
      <a class="a" href="${link}" onclick="return openReport('${it.id}')" rel="noopener noreferrer">Abrir</a>
      <button class="a" type="button" onclick="return copyLink('${it.id}')">Copiar</button>
      <a class="a primary" href="${link}" onclick="return openReport('${it.id}')" rel="noopener noreferrer">Ir ahora</a>
    </div>
  </article>`;
}

function render(){
  document.getElementById('static').hidden=true;
  app.hidden=false;

  const term=q.value.trim().toLowerCase();
  const items=Object.entries(REPORTS)
    .map(([id,v])=>({id,name:v.name,cat:categorize(id,v.name)}))
    .filter(x=>!term||x.id.toLowerCase().includes(term)||x.name.toLowerCase().includes(term));

  if(!grouped){
    app.innerHTML=`<div class="grid">${items.map(card).join("")||`<div class="empty">Sin resultados</div>`}</div>`;
    return;
  }
  const groups={}; for(const it of items){ (groups[it.cat]??=[]).push(it); }
  const order=Object.keys(groups).sort((a,b)=>a.localeCompare(b,'es'));
  app.innerHTML=order.map(cat=>`
    <section>
      <h2 style="font-size:1rem;margin:12px 0 8px">${esc(cat)} <span class="tag">${groups[cat].length}</span></h2>
      <div class="grid">${groups[cat].map(card).join("")}</div>
    </section>`).join("") || `<div class="empty">Sin resultados</div>`;
}
q.addEventListener("input",render);
btnGroup.addEventListener("click",()=>{grouped=!grouped;btnGroup.setAttribute("aria-pressed",String(grouped));render();});
btnIds.addEventListener("click",()=>{showIds=!showIds;btnIds.setAttribute("aria-pressed",String(showIds));render();});
window.addEventListener('DOMContentLoaded', render, {once:true});

/* ====== TRACKING SIN BLOQUEO ====== */
function openReport(id){
  const target = TARGETS[id];
  if(!target){
    alert("Falta configurar la URL del reporte: " + id);
    return false;
  }
  try {
    const payload = new Blob([JSON.stringify({
      r: id,
      name: REPORTS[id]?.name || "",
      ts: Date.now(),
      userAgent: navigator.userAgent,
      source: "github_index"
    })], { type: "application/json" });
    if (navigator.sendBeacon) navigator.sendBeacon(TRACK_URL, payload);
    else throw 0;
  } catch(e) {
    fetch(TRACK_URL, { method:"POST", mode:"no-cors", body: JSON.stringify({
      r:id, name: REPORTS[id]?.name||"", ts: Date.now(), source:"github_index"
    }) });
  }
  window.location.href = target; // navegar inmediato
  return false;
}

function copyLink(id){
  const link = TARGETS[id];
  if(!link){ showToast("Sin URL"); return false; }
  if (navigator.clipboard?.writeText) {
    navigator.clipboard.writeText(link).then(()=>showToast("Copiado"),()=>showToast("No se pudo copiar"));
  } else {
    // Fallback
    const ta=document.createElement('textarea');
    ta.value=link; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); showToast("Copiado"); }catch{ showToast("No se pudo copiar"); }
    document.body.removeChild(ta);
  }
  return false;
}
</script>
</body>
</html>
