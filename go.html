<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Redirigiendo‚Ä¶ | Datos Hacendarios</title>
<meta name="color-scheme" content="light dark">
<style>
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    margin: 0;
    padding: 40px;
    text-align: center;
    background: #f8f9fc;
    color: #222;
  }
  @media (prefers-color-scheme: dark) {
    body { background: #0b0d12; color: #f3f4f8; }
  }
  .loader {
    border: 4px solid rgba(0,0,0,0.1);
    border-top: 4px solid #2f6fed;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>
<h2>Redirigiendo al reporte...</h2>
<p id="msg">Por favor espera un momento.</p>
<div class="loader"></div>

<script>
(async function(){
  // === CONFIG ===
  const DEPLOY_ID = "TU_DEPLOY_ID_AQUI";  // üëà reempl√°zalo por el ID de tu Apps Script (Deployment ID)
  const BASE = `https://script.google.com/macros/s/${DEPLOY_ID}/exec`;

  // === PAR√ÅMETROS ===
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if (!id) {
    document.getElementById("msg").textContent = "Falta el par√°metro ?id= en la URL.";
    return;
  }

  // === CONSTRUYE URL DE REDIRECCI√ìN HACIA Apps Script ===
  const src = location.origin + location.pathname; // URL del GitHub que llam√≥
  const url = `${BASE}?id=${encodeURIComponent(id)}&src=${encodeURIComponent(src)}`;

  // === LOG & REDIRECCI√ìN ===
  document.getElementById("msg").textContent = `Conectando con el servidor para abrir el reporte: ${id}`;
  try {
    // peque√±a espera para asegurar registro
    await new Promise(r => setTimeout(r, 100));
    location.replace(url);
  } catch (err) {
    document.getElementById("msg").textContent = "No se pudo redirigir autom√°ticamente. Abre el siguiente enlace:";
    const a = document.createElement("a");
    a.href = url;
    a.textContent = "Ir manualmente";
    document.body.appendChild(a);
  }
})();
</script>
</body>
</html>
